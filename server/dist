const express=require("express");require("dotenv").config();const path=require("path"),{ApolloServer:ApolloServer}=require("apollo-server-express"),cors=require("cors"),{authMiddleware:authMiddleware}=require("./utils/auth"),{typeDefs:typeDefs,resolvers:resolvers}=require("./schemas"),db=require("./config/connection"),app=express(),PORT=process.env.PORT||3001,server=new ApolloServer({typeDefs:typeDefs,resolvers:resolvers,context:authMiddleware});app.use(express.urlencoded({extended:!0})),app.use(express.json()),app.use(cors()),"production"===process.env.NODE_ENV&&app.use(express.static(path.join(__dirname,"../client/build")));const startApolloServer=async(e,r)=>{await server.start(),server.applyMiddleware({app:app}),db.once("open",(()=>{app.listen(PORT,(()=>{console.log(`API server running on port ${PORT}!`),console.log(`Use GraphQL at http://localhost:${PORT}${server.graphqlPath}`)}))}))};startApolloServer();